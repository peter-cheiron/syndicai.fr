<!-- Modal -->
@if (zoomedImage) {
<div
  class="fixed inset-0 z-50 bg-black/80 flex items-center justify-center p-4 sm:p-8"
  (click)="closeZoom()"
>
  <div
    class="relative w-full max-w-full sm:max-w-4xl max-h-[90vh] flex flex-col items-center justify-center"
  >
    <img
      [src]="zoomedImage"
      class="object-contain max-h-[90vh] w-full rounded-lg shadow-xl transition"
      (click)="$event.stopPropagation()"
    />

    <div
      class="w-full rounded-b-lg shadow-lg mt-4"
      (click)="$event.stopPropagation()"
    >
      <button
        class="absolute top-3 right-3 text-white text-xl bg-black/50 hover:bg-black rounded-full w-8 h-8 flex items-center justify-center"
        (click)="closeZoom()"
        aria-label="Close"
      >
        &times;
      </button>
    </div>
  </div>
</div>
}

<!-- end of modal -->

<div
  class="w-full max-w-3xl bg-[var(--color-surface,#ffffff)] rounded-xl shadow overflow-hidden flex flex-col sm:flex-row-reverse border border-[var(--color-border,#e5f4ec)]"
>
  <!-- Image -->
  <div class="relative sm:w-1/3 w-full h-64 sm:h-64 lg:h-72 overflow-hidden">
    <img
      [src]="image"
      [alt]="title"
      class="object-cover w-full h-full max-h-full cursor-zoom-in transition hover:brightness-90"
      (click)="openZoom(image)"
    />
    @if(type){
    <span
      [ngClass]="{
        'bg-[var(--color-warning,#938652)]/20 text-[color:var(--color-warning,#938652)]':
          type === 'sale',
        'bg-[var(--color-primary,#10b981)]/15 text-[color:var(--color-primary,#10b981)]':
          type === 'wish'
      }"
      class="absolute top-2 right-2 text-xs px-2 py-0.5 rounded-full shadow"
    >
      {{ type }}
    </span>
    }
  </div>

  <!-- Content -->
  <div class="flex-1 p-4 flex flex-col justify-between min-h-[200px]">
    <!-- Header row -->
    <div class="flex justify-between items-start mb-2">
      <h3 class="text-lg font-semibold text-[color:var(--color-text,#1f2937)]">
        {{ title }}
      </h3>
    </div>

    <!-- Description -->
    <p class="text-sm text-(--color-muted,#6b7280) line-clamp-3">
      {{ description }}
    </p>
    @if (metadata) {
    <div class="flex flex-wrap gap-2 mt-2 mb-2 overflow-y-auto">
      @for (entry of getValuesToDisplay(); track entry) {
      <span
        class="px-2 py-1 text-xs rounded-full bg-[var(--color-bg,#f7fdf9)] text-[color:var(--color-text,#1f2937)] border border-[var(--color-border,#e5f4ec)]"
      >
        {{ formatKey(entry) + ": " }}{{ getValue(entry) }}
      </span>
      }
    </div>
    }

    <!-- Footer 
    use ng-content here to control action 
    -->
    <div class="mt-4 flex items-center justify-between w-full">
      <div class="flex items-center gap-3">
        <div
          class="text-xs text-[color:var(--color-text,#1f2937)] flex items-center gap-1"
        >
          {{ lastDate | date : "mediumDate" }}
        </div>

        @if(userName){
        <div
          class="text-xs text-[color:var(--color-text,#1f2937)] flex items-center gap-1"
        >
          &#64;{{ userName }}
        </div>
        } @if (location) {
        <div
          class="text-xs text-[color:var(--color-text,#1f2937)] flex items-center gap-1"
        >
          <svg
            class="w-4 h-4 text-[color:var(--color-text,#1f2937)]"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              d="M12 2C8.14 2 5 5.14 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.86-3.14-7-7-7zm0 9.5a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5z"
            />
          </svg>
          {{ location?.displayName }}
        </div>
        } @if (url) {
        <div
          class="text-xs text-[color:var(--color-text,#1f2937)] flex items-center gap-1"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-4 h-4 text-[color:var(--color-text,#1f2937)]"
            fill="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              d="M10.59 13.41a1 1 0 0 0 1.41 0l4.59-4.59a1 1 0 0 0-1.41-1.41l-4.59 4.59a1 1 0 0 0 0 1.41zM6.34 17.66a4 4 0 0 1 0-5.66l2.83-2.83a4 4 0 0 1 5.66 0 1 1 0 0 0 1.41-1.41 6 6 0 0 0-8.48 0l-2.83 2.83a6 6 0 0 0 8.48 8.48l2.83-2.83a1 1 0 1 0-1.41-1.41l-2.83 2.83a4 4 0 0 1-5.66 0z"
            />
          </svg>

          <a href="url" target="_blank">link</a>
        </div>
        }
      </div>

      <ng-content select="[item-actions]"></ng-content>
    </div>
  </div>
</div>
