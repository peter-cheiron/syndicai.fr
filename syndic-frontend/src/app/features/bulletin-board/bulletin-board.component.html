<section
  class="w-full max-w-5xl space-y-4 m-4"
  [style.color]="'var(--color-text)'"
>
  <header class="flex items-center justify-between">
    <div>
      <h2 class="text-base font-semibold">
        Building bulletin
      </h2>
      <p class="text-xs" [style.color]="'var(--color-muted)'">
        Centralised updates for all residents.
      </p>
    </div>
    <div class="text-[10px] px-2 py-1 rounded-full border" [style.borderColor]="'var(--color-border)'" [style.color]="'var(--color-muted)'">
      {{ items().length }} update{{ items().length === 1 ? '' : 's' }}
    </div>
  </header>

  <div class="flex flex-col lg:flex-row gap-4 items-start">
    <div class="w-full lg:w-2/5 space-y-2">

      @if (items && items().length === 0) {
        <div
          class="rounded-xl border px-3 py-4 text-xs"
          [style.backgroundColor]="'var(--color-surface)'"
          [style.borderColor]="'var(--color-border)'"
          [style.color]="'var(--color-muted)'"
        >
          No bulletins yet. When the Syndic posts an update, it will appear here.
        </div>
      } @else {
        <div class="flex flex-col gap-2">
          @for (item of items(); track item.id) {
            <article
              class="rounded-xl border px-3 py-2 text-xs flex flex-col gap-1 cursor-pointer transition-all"
              (click)="selectBulletin(item)"
              [style.backgroundColor]="selectedBulletin()?.id === item.id ? 'var(--color-bg)' : 'var(--color-surface)'"
              [style.borderColor]="selectedBulletin()?.id === item.id ? 'var(--color-primary)' : 'var(--color-border)'"
              [style.boxShadow]="selectedBulletin()?.id === item.id ? 'var(--shadow-elev)' : ''"
            >
              <div class="flex items-center gap-2">
                <span
                  class="inline-flex items-center rounded-full px-2 py-[2px] text-[10px] font-semibold"
                  [ngStyle]="{
                    'background-color': item.kind === 'works'
                      ? 'rgba(251, 191, 36, 0.12)'
                      : 'rgba(59, 130, 246, 0.12)',
                    'color': item.kind === 'works'
                      ? '#facc15'
                      : '#bfdbfe'
                  }"
                >
                  {{ levelLabel(item.kind) }}
                </span>
                <h3 class="text-xs font-semibold truncate">
                  {{ item.title }}
                </h3>
              </div>

              <p class="text-[11px] leading-snug" [style.color]="'var(--color-muted)'">
                {{ bodyPreview(item.message) }}
              </p>

              <div class="flex items-center gap-2 text-[10px]" [style.color]="'var(--color-muted)'">
                <span>{{ item.date | date:'mediumDate' }}</span>
              </div>
            </article>
          }
        </div>
      }
    </div>

    <div class="w-full lg:flex-1 space-y-3">
      @if (canPost) {
        <div
          class="rounded-xl border p-3 space-y-2"
          [style.backgroundColor]="'var(--color-surface)'"
          [style.borderColor]="'var(--color-border)'"
          
        >
          <div class="flex items-center gap-2">
            <span class="text-xs font-medium" [style.color]="'var(--color-muted)'">
              New bulletin
            </span>
            <select
              class="text-xs px-2 py-1 rounded border bg-transparent"
              [style.borderColor]="'var(--color-border)'"
              [ngModel]="newLevel()"
              (ngModelChange)="newLevel.set($event)"
            >
              <option value="info">Info</option>
              <option value="works">Travaux</option>
            </select>
          </div>

          <input
            type="text"
            class="w-full text-sm px-2 py-1 rounded border bg-transparent"
            [style.borderColor]="'var(--color-border)'"
            [placeholder]="'Short title…'"
            [ngModel]="newTitle()"
            (ngModelChange)="newTitle.set($event)"
          />

          <textarea
            rows="2"
            class="w-full text-xs px-2 py-1 rounded border bg-transparent resize-none"
            [style.borderColor]="'var(--color-border)'"
            [placeholder]="'Details for residents…'"
            [ngModel]="newBody()"
            (ngModelChange)="newBody.set($event)"
          ></textarea>

          <div class="flex justify-end">
            <button
              type="button"
              class="text-xs font-medium px-3 py-1 rounded-md"
              [style.backgroundColor]="'var(--color-primary)'"
              [style.color]="'#ffffff'"
            >
              Publish
            </button>
          </div>
        </div>
      }

      <div
        class="rounded-xl border p-4 min-h-[240px]"
        [style.backgroundColor]="'var(--color-surface)'"
        [style.borderColor]="'var(--color-border)'"
        
      >
        @if (selectedBulletin()) {
          <div class="flex items-start justify-between gap-3">
            <div class="flex-1 space-y-2">
              <div class="flex items-center gap-2">
                <span
                  class="inline-flex items-center rounded-full px-2 py-[2px] text-[10px] font-semibold"
                  [ngStyle]="{
                    'background-color': selectedBulletin()?.kind === 'works'
                      ? 'rgba(251, 191, 36, 0.12)'
                      : 'rgba(59, 130, 246, 0.12)',
                    'color': selectedBulletin()?.kind === 'works'
                      ? '#facc15'
                      : '#bfdbfe'
                  }"
                >
                  {{ levelLabel(selectedBulletin()?.kind!) }}
                </span>
                <div class="text-[10px]" [style.color]="'var(--color-muted)'">
                  {{ selectedBulletin()?.date | date:'fullDate' }}
                </div>
              </div>

              <h3 class="text-lg font-semibold">
                {{ selectedBulletin()?.title }}
              </h3>

              <p class="text-sm leading-relaxed whitespace-pre-line">
                {{ selectedBulletin()?.message }}
              </p>
            </div>
          </div>
        } @else {
          <div class="text-xs" [style.color]="'var(--color-muted)'">
            Select a bulletin on the left to view details.
          </div>
        }
      </div>
    </div>
  </div>
</section>
