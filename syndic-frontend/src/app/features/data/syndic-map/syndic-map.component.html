<div class="flex flex-col h-screen bg-[var(--color-bg,#f7fdf9)] text-[var(--color-text,#111827)]">
  <!-- Header -->
  <header class="px-4 pt-4 pb-2">
    <h1 class="text-base font-semibold">
      Carte des syndics √† Paris (data.gouv.fr)
    </h1>
    <p class="text-xs text-[var(--color-muted,#6b7280)] mt-1">
      Chaque point repr√©sente un batiments avec ou sans syndic. Utilisez le panneau √† gauche pour filtrer et inspecter.
    </p>
  </header>

  <!-- Main layout -->
  <div class="flex flex-1 gap-4 px-4 pb-4">
    <!-- Sidebar -->
    <aside
      class="w-72 bg-white border border-[var(--color-border,#e5f4ec)] rounded-2xl p-4 shadow-[0_8px_30px_rgba(16,185,129,0.08)] flex flex-col gap-4 text-sm"
    >
      <section>
        <h2 class="text-xs font-semibold mb-2 uppercase tracking-wide text-[var(--color-muted,#6b7280)]">
          Filtres
        </h2>

        <div class="space-y-3">
          <div class="flex flex-col gap-1">
            <label class="text-[11px] text-[var(--color-muted,#6b7280)]">
              Rechercher un syndic
            </label>
            <input
              type="search"
              class="w-full rounded-lg border border-[var(--color-border,#e5f4ec)] px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-[var(--color-primary,#10b981)]"
              placeholder="Nom du syndic‚Ä¶"
              list="syndic-list"
              [value]="syndicQuery"
              (input)="onSearchChange('syndic', $event.target.value)"
            />
            <datalist id="syndic-list">
              @for (name of syndicItems; track name) {
                <option [value]="name"></option>
              }
            </datalist>
          </div>

          <div class="flex flex-col gap-1">
            <label class="text-[11px] text-[var(--color-muted,#6b7280)]">
              Rechercher une adresse
            </label>
            <input
              type="search"
              class="w-full rounded-lg border border-[var(--color-border,#e5f4ec)] px-3 py-2 text-xs focus:outline-none focus:ring-2 focus:ring-[var(--color-primary,#10b981)]"
              placeholder="Adresse‚Ä¶"
              list="address-list"
              [value]="addressQuery"
              (input)="onSearchChange('address', $event.target.value)"
            />
            <datalist id="address-list">
              @for (addr of addressItems; track addr) {
                <option [value]="addr"></option>
              }
            </datalist>
          </div>
        </div>

        <div class="space-y-2 border-t border-[var(--color-border,#e5f4ec)] pt-2">
          <h3 class="text-xs font-medium mb-1">Type de gestion</h3>

          <label class="flex items-center gap-2 text-xs text-slate-700">
            <input
              type="checkbox"
              class="rounded border-slate-300"
              [checked]="typeFilterState.professionnel"
              (change)="typeFilterState.professionnel = !typeFilterState.professionnel; onFilterChange()"
            />
            Professionnel
          </label>

          <label class="flex items-center gap-2 text-xs text-slate-700">
            <input
              type="checkbox"
              class="rounded border-slate-300"
              [checked]="typeFilterState.benevole"
              (change)="typeFilterState.benevole = !typeFilterState.benevole; onFilterChange()"
            />
            B√©n√©vole
          </label>

          <label class="flex items-center gap-2 text-xs text-slate-700">
            <input
              type="checkbox"
              class="rounded border-slate-300"
              [checked]="typeFilterState.unknown"
              (change)="typeFilterState.unknown = !typeFilterState.unknown; onFilterChange()"
            />
            Inconnu
          </label>
        </div>


          <!-- üëá Mandate type -->
  <div class="space-y-2 border-t border-[var(--color-border,#e5f4ec)] pt-3 mt-2">
    <h3 class="text-xs font-medium mb-1">Type de mandat</h3>

    @for (m of mandateStatus; track m) {
      <label class="flex items-center gap-2 text-xs text-slate-700">
        <input
          type="checkbox"
          class="rounded border-slate-300"
          [checked]="mandateFilterState[m]"
          (change)="mandateFilterState[m] = !mandateFilterState[m]; onFilterChange()"
        />
        <span class="leading-snug">
          {{ m }}
        </span>
      </label>
    }
  </div>

      </section>

      <!-- Stats -->
      <section class="border-t border-[var(--color-border,#e5f4ec)] pt-3">
        <h3 class="text-xs font-medium mb-1">Statut de la vue</h3>
        <p class="text-[11px] text-[var(--color-muted,#6b7280)] leading-snug">
          Points visibles :
          <span class="font-semibold text-[var(--color-primary,#10b981)]">
            {{ visibleCount }}
          </span>
        </p>
      </section>

      <!-- Selected point -->
      <section class="border-t border-[var(--color-border,#e5f4ec)] pt-3">
        <h3 class="text-xs font-medium mb-2">S√©lection</h3>

        @if (selectedPoint) {
          <div class="text-[11px] space-y-1">
            <div class="font-semibold">
              {{ selectedPoint?.name }}
            </div>
            <div class="text-[var(--color-muted,#6b7280)]">
              {{ selectedPoint?.address }}
            </div>
            <div class="text-[var(--color-muted,#6b7280)]">
              <span *ngIf="selectedPoint?.arrondissementLabel">
                {{ selectedPoint?.arrondissementLabel }}
              </span>
            </div>
            <div class="mt-1">
              <span
                class="inline-flex items-center rounded-full px-2 py-0.5 text-[10px]"
                [ngClass]="{
                  'bg-blue-100 text-blue-700': selectedPoint?.managerType === 'professionnel',
                  'bg-emerald-100 text-emerald-700': selectedPoint?.managerType === 'benevole',
                  'bg-slate-100 text-slate-600': !selectedPoint?.managerType || selectedPoint?.managerType === 'unknown'
                }"
              >
                {{ selectedPoint?.managerType || 'inconnu' }}
              </span>
            </div>
          </div>
        } @else {
          <p class="text-[11px] text-[var(--color-muted,#6b7280)]">
            Cliquez sur un point sur la carte pour voir le d√©tail ici.
          </p>
        }
      </section>
    </aside>

    <!-- Map panel -->
    <div
      class="flex-1 bg-white border border-[var(--color-border,#e5f4ec)] rounded-2xl p-2 shadow-[0_8px_30px_rgba(16,185,129,0.08)]"
    >
      <svg #svgEl class="w-full h-full"></svg>
    </div>
  </div>

  <div class="text-[12px]">
    Data used is from publicly available data at https://explore.data.gouv.fr/fr/datasets/62da71c068871f4c54258c7c/#/resources/cc062fa7-4a80-449c-ab73-d2856b455ec9
  </div>
</div>
